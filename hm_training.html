<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>13.1 Training</title>
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' rx='40' fill='%230e0e10'/><text x='90' y='115' font-size='100' text-anchor='middle'>ðŸ‘Ÿ</text></svg>">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ‘Ÿ</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0e0e10;
  --surface: #1a1a1f;
  --surface-raised: #222228;
  --border: #2a2a32;
  --text: #e8e8ec;
  --text-dim: #7a7a88;
  --text-muted: #4a4a55;
  --green: #1db954;
  --green-dim: #1a7a3a;
  --green-bg: rgba(29, 185, 84, 0.08);
  --orange: #e67e22;
  --orange-bg: rgba(230, 126, 34, 0.08);
  --blue: #3498db;
  --blue-bg: rgba(52, 152, 219, 0.08);
  --red: #e74c3c;
  --red-bg: rgba(231, 76, 60, 0.08);
  --rest-color: #555566;
  --radius: 12px;
  --radius-sm: 8px;
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€â”€ HEADER â”€â”€â”€ */
.header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(14, 14, 16, 0.85);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  padding: 16px 20px 12px;
}

.header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.header h1 {
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -0.5px;
}

.header h1 span { color: var(--green); }

.race-countdown {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--text-dim);
  background: var(--surface);
  padding: 4px 10px;
  border-radius: 20px;
  border: 1px solid var(--border);
}

.month-nav {
  display: flex;
  gap: 4px;
}

.month-nav button {
  flex: 1;
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text-dim);
  font-family: 'DM Sans', sans-serif;
  font-size: 13px;
  font-weight: 500;
  padding: 8px 0;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s;
}

.month-nav button.active {
  background: var(--green);
  border-color: var(--green);
  color: #fff;
  font-weight: 600;
}

.month-nav button:not(.active):hover {
  border-color: var(--text-muted);
  color: var(--text);
}

/* â”€â”€â”€ CALENDAR GRID â”€â”€â”€ */
.calendar-container {
  padding: 16px 12px;
}

.day-labels {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  margin-bottom: 6px;
  padding: 0 2px;
}

.day-labels span {
  text-align: center;
  font-size: 11px;
  font-weight: 500;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
}

.cal-day {
  aspect-ratio: 1 / 1.15;
  background: var(--surface);
  border-radius: var(--radius-sm);
  padding: 6px;
  display: flex;
  flex-direction: column;
  cursor: pointer;
  transition: all 0.15s;
  border: 1.5px solid transparent;
  position: relative;
  overflow: hidden;
}

.cal-day:active { transform: scale(0.96); }

.cal-day.empty {
  background: transparent;
  cursor: default;
}

.cal-day.today {
  border-color: var(--green);
  box-shadow: 0 0 12px rgba(29, 185, 84, 0.15);
}

.cal-day.has-log::after {
  content: '';
  position: absolute;
  top: 5px;
  right: 5px;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--green);
}

.cal-day .date-num {
  font-size: 13px;
  font-weight: 600;
  color: var(--text);
  line-height: 1;
}

.cal-day.rest-day .date-num { color: var(--text-muted); }

.cal-day .workout-tag {
  margin-top: 3px;
  font-size: 9px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  line-height: 1.2;
}

.cal-day .workout-dist {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  font-weight: 500;
  margin-top: 1px;
  color: var(--text-dim);
  white-space: nowrap;
}

.tag-easy { color: var(--green); }
.tag-long { color: var(--green); }
.tag-tempo { color: var(--orange); }
.tag-cross { color: var(--blue); }
.tag-rest { color: var(--rest-color); }
.tag-race { color: var(--red); }
.tag-shakeout { color: var(--green); }

/* â”€â”€â”€ WEEK SUMMARY BAR â”€â”€â”€ */
.week-summary {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin: 0 12px 16px;
  padding: 14px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.week-summary-label {
  font-size: 12px;
  color: var(--text-dim);
  font-weight: 500;
}

.week-summary-label strong {
  color: var(--text);
  font-size: 14px;
}

.week-summary-stats {
  display: flex;
  gap: 16px;
}

.week-stat {
  text-align: right;
}

.week-stat .val {
  font-family: 'JetBrains Mono', monospace;
  font-size: 16px;
  font-weight: 600;
  color: var(--green);
}

.week-stat .label {
  font-size: 10px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* â”€â”€â”€ BACKUP BAR â”€â”€â”€ */
.backup-bar {
  display: flex;
  gap: 8px;
  margin: 0 12px 12px;
  max-width: 500px;
}

@media (min-width: 500px) {
  .backup-bar { margin-left: auto; margin-right: auto; }
}

.backup-bar button {
  flex: 1;
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text-dim);
  font-family: 'DM Sans', sans-serif;
  font-size: 12px;
  font-weight: 500;
  padding: 10px 0;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.15s;
}

.backup-bar button:active { transform: scale(0.97); }
.backup-bar button:hover { border-color: var(--text-muted); color: var(--text); }

.import-input { display: none; }

.backup-toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: var(--green);
  color: #fff;
  padding: 10px 20px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
  z-index: 300;
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s;
}

.backup-toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* â”€â”€â”€ PROFILE BUTTON â”€â”€â”€ */
.profile-btn {
  display: block;
  width: calc(100% - 24px);
  max-width: 500px;
  margin: 0 auto 16px;
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text-dim);
  font-family: 'DM Sans', sans-serif;
  font-size: 13px;
  font-weight: 500;
  padding: 12px 16px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.15s;
  text-align: left;
}

.profile-btn:active { transform: scale(0.98); }
.profile-btn:hover { border-color: var(--text-muted); color: var(--text); }

.profile-btn .profile-btn-title {
  font-weight: 600;
  color: var(--text);
  margin-bottom: 2px;
}

/* â”€â”€â”€ INFO PANEL (full screen overlay) â”€â”€â”€ */
.info-overlay {
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 250;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  transform: translateX(100%);
  transition: transform 0.3s cubic-bezier(0.22, 1, 0.36, 1);
}

.info-overlay.open {
  transform: translateX(0);
}

.info-header {
  position: sticky;
  top: 0;
  background: rgba(14, 14, 16, 0.9);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  padding: 16px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 10;
}

.info-header h2 {
  font-size: 18px;
  font-weight: 700;
}

.info-close {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  color: var(--text-dim);
  font-family: 'DM Sans', sans-serif;
  font-size: 13px;
  font-weight: 500;
  padding: 8px 14px;
  border-radius: 20px;
  cursor: pointer;
}

.info-close:active { transform: scale(0.95); }

.info-body {
  padding: 20px;
  max-width: 540px;
  margin: 0 auto;
  padding-bottom: 60px;
}

.info-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 18px;
  margin-bottom: 14px;
}

.info-card h3 {
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  color: var(--green);
  margin-bottom: 12px;
}

.info-card h4 {
  font-size: 13px;
  font-weight: 600;
  color: var(--text);
  margin-top: 14px;
  margin-bottom: 6px;
}

.info-card h4:first-of-type { margin-top: 0; }

.info-row {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
  font-size: 14px;
}

.info-row:last-child { border-bottom: none; }
.info-row .info-label { color: var(--text-dim); }
.info-row .info-value { color: var(--text); font-weight: 500; }

.info-card p {
  font-size: 14px;
  line-height: 1.65;
  color: var(--text-dim);
  margin-bottom: 10px;
}

.info-card p:last-child { margin-bottom: 0; }

.info-card p strong {
  color: var(--text);
  font-weight: 600;
}

/* â”€â”€â”€ PLAN SUMMARY â”€â”€â”€ */
.plan-summary {
  margin: 0 12px 100px;
  padding: 16px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
}

.plan-summary h3 {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--text);
}

.plan-summary .phase {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
  font-size: 13px;
}

.plan-summary .phase:last-child { border-bottom: none; }
.plan-summary .phase .weeks { color: var(--text-dim); font-size: 12px; }
.plan-summary .phase .desc { color: var(--text); font-weight: 500; }
.plan-summary .phase .miles { font-family: 'JetBrains Mono', monospace; color: var(--green); font-size: 12px; }

/* â”€â”€â”€ DAY DETAIL MODAL â”€â”€â”€ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  z-index: 200;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s;
}

.modal-overlay.open {
  opacity: 1;
  pointer-events: auto;
}

.modal-sheet {
  background: var(--surface);
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
  width: 100%;
  max-width: 500px;
  max-height: 85dvh;
  overflow-y: auto;
  padding: 0 20px 40px;
  transform: translateY(100%);
  transition: transform 0.3s cubic-bezier(0.22, 1, 0.36, 1);
}

.modal-overlay.open .modal-sheet {
  transform: translateY(0);
}

.modal-handle {
  width: 36px;
  height: 4px;
  background: var(--text-muted);
  border-radius: 2px;
  margin: 12px auto 20px;
}

.modal-date {
  font-size: 24px;
  font-weight: 700;
  letter-spacing: -0.5px;
  margin-bottom: 4px;
}

.modal-weekday {
  font-size: 13px;
  color: var(--text-dim);
  margin-bottom: 20px;
}

.modal-workout-card {
  padding: 16px;
  border-radius: var(--radius);
  margin-bottom: 20px;
}

.modal-workout-card.type-easy,
.modal-workout-card.type-long,
.modal-workout-card.type-shakeout { background: var(--green-bg); border: 1px solid rgba(29, 185, 84, 0.15); }
.modal-workout-card.type-tempo { background: var(--orange-bg); border: 1px solid rgba(230, 126, 34, 0.15); }
.modal-workout-card.type-cross { background: var(--blue-bg); border: 1px solid rgba(52, 152, 219, 0.15); }
.modal-workout-card.type-rest { background: rgba(85, 85, 102, 0.08); border: 1px solid rgba(85, 85, 102, 0.15); }
.modal-workout-card.type-race { background: var(--red-bg); border: 1px solid rgba(231, 76, 60, 0.15); }

.workout-card-type {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 4px;
}

.workout-card-dist {
  font-family: 'JetBrains Mono', monospace;
  font-size: 28px;
  font-weight: 600;
  color: var(--text);
}

.workout-card-note {
  font-size: 13px;
  color: var(--text-dim);
  margin-top: 8px;
  line-height: 1.5;
}

/* â”€â”€â”€ LOG FORM â”€â”€â”€ */
.log-section {
  margin-top: 4px;
}

.log-section h4 {
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-dim);
  margin-bottom: 12px;
}

.log-field {
  margin-bottom: 14px;
}

.log-field label {
  display: block;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-dim);
  margin-bottom: 6px;
}

.log-field input,
.log-field textarea,
.log-field select {
  width: 100%;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 12px;
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 15px;
  outline: none;
  transition: border-color 0.2s;
}

.log-field input:focus,
.log-field textarea:focus,
.log-field select:focus {
  border-color: var(--green);
}

.log-field textarea {
  resize: vertical;
  min-height: 80px;
}

.log-field select {
  -webkit-appearance: none;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%237a7a88'%3E%3Cpath d='M6 8L1 3h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
}

.log-actions {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.btn {
  flex: 1;
  padding: 14px;
  border-radius: var(--radius-sm);
  font-family: 'DM Sans', sans-serif;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
  border: none;
}

.btn:active { transform: scale(0.97); }

.btn-primary {
  background: var(--green);
  color: #fff;
}

.btn-secondary {
  background: var(--surface-raised);
  color: var(--text-dim);
  border: 1px solid var(--border);
}

.btn-danger {
  background: transparent;
  color: var(--red);
  border: 1px solid rgba(231, 76, 60, 0.25);
  font-size: 13px;
}

.saved-indicator {
  text-align: center;
  font-size: 13px;
  color: var(--green);
  margin-top: 10px;
  opacity: 0;
  transition: opacity 0.3s;
}

.saved-indicator.show { opacity: 1; }

@media (min-width: 500px) {
  .calendar-container { max-width: 500px; margin: 0 auto; padding: 20px; }
  .week-summary, .plan-summary { max-width: 500px; margin-left: auto; margin-right: auto; }
  .plan-summary { margin-bottom: 100px; }
  .header { padding: 16px 20px 12px; }
  .header > * { max-width: 500px; margin-left: auto; margin-right: auto; }
}
</style>
</head>
<body>

<div class="header">
  <div class="header-top">
    <h1>13.1 <span>Training</span></h1>
    <div class="race-countdown" id="countdown"></div>
  </div>
  <div class="month-nav" id="monthNav"></div>
</div>

<div id="weekSummary" class="week-summary" style="display:none;"></div>
<div class="calendar-container" id="calendarContainer"></div>
<div class="backup-bar">
  <button onclick="exportData()">â†“ Export backup</button>
  <button onclick="document.getElementById('importFile').click()">â†‘ Import backup</button>
  <input type="file" id="importFile" class="import-input" accept=".json" onchange="importData(event)">
</div>
<div id="planSummary"></div>

<button class="profile-btn" onclick="openInfo()">
  <div class="profile-btn-title">My plan &amp; guidance</div>
  Profile, prep, recovery, nutrition tips
</button>

<div class="backup-toast" id="toast"></div>

<div class="info-overlay" id="infoPanel">
  <div class="info-header">
    <h2>My Plan &amp; Guidance</h2>
    <button class="info-close" onclick="closeInfo()">Done</button>
  </div>
  <div class="info-body">

    <div class="info-card">
      <h3>Your Profile</h3>
      <div class="info-row"><span class="info-label">Age</span><span class="info-value">44 (born May 1981)</span></div>
      <div class="info-row"><span class="info-label">Weight</span><span class="info-value">180 lbs</span></div>
      <div class="info-row"><span class="info-label">Height</span><span class="info-value">5'9"</span></div>
      <div class="info-row"><span class="info-label">BMI</span><span class="info-value">26.6</span></div>
      <div class="info-row"><span class="info-label">Goal race</span><span class="info-value">Half marathon, sub-2:10</span></div>
      <div class="info-row"><span class="info-label">Target pace</span><span class="info-value">~9:55/mi</span></div>
    </div>

    <div class="info-card">
      <h3>Baseline Activity</h3>
      <p>You're coming into this plan with a solid aerobic base. Running 3x/week at 3.5â€“4 miles per run gives you roughly 10â€“12 miles per week. Add in 2x/week weighted vest walks (20 lbs), regular climbing sessions, and hot yoga, and your overall conditioning is strong â€” especially cardiovascular and lower-body endurance.</p>
      <p>This plan was built to respect that base without overloading you. The ramp is conservative because at 44, tendon and joint adaptation lags behind cardiovascular fitness. Your heart will be ready for more mileage before your connective tissue is.</p>
    </div>

    <div class="info-card">
      <h3>Why This Plan</h3>
      <p>Sub-2:10 requires averaging ~9:55/mi for 13.1 miles. Based on your current easy pace and activity level, this is achievable but will require disciplined long runs and some tempo work to develop race-pace comfort.</p>
      <p><strong>Peak mileage is capped at ~25.5 mi/week.</strong> For a runner in their mid-40s building from 10â€“12 mi/week, going much higher increases injury risk without proportional benefit. The two cutback weeks (4 and 8) are critical â€” they let your body consolidate gains.</p>
      <p><strong>The 2-week taper</strong> is standard for half marathon distance. You'll feel restless during taper. That's normal. Trust it.</p>
    </div>

    <div class="info-card">
      <h3>Prep &amp; Recovery</h3>

      <h4>Before Runs</h4>
      <p><strong>Easy/short runs:</strong> 5â€“10 min of walking or dynamic stretches (leg swings, high knees) is plenty. Don't overthink it.</p>
      <p><strong>Tempo runs:</strong> Warm up with 0.5 mi of easy jogging before picking up pace. Cold starts at tempo pace are an injury invitation.</p>
      <p><strong>Long runs:</strong> Eat something light 60â€“90 min before (toast, banana, whatever sits well). Hydrate the night before.</p>

      <h4>After Runs</h4>
      <p><strong>All runs:</strong> Walk for 3â€“5 minutes after finishing. Don't just stop. Light stretching or foam rolling if you have time â€” calves, quads, hip flexors especially.</p>
      <p><strong>Long runs (8+ mi):</strong> Refuel within 30 minutes. Protein + carbs. Chocolate milk, a smoothie, or a real meal if you can stomach it. Your body is primed to absorb and repair in that window.</p>
      <p><strong>Ice baths / cold exposure:</strong> Optional. If your legs feel beat up after a long run, 10 min of cold water on your legs can help. Don't force it.</p>

      <h4>Sleep</h4>
      <p>This is the single most important recovery tool. Aim for 7â€“8 hours, especially the nights before and after long runs. Growth hormone release during deep sleep is when your body actually adapts to training stress.</p>

      <h4>Cross-Training Days</h4>
      <p>Your weighted walks, climbing, and yoga are ideal cross-training. They maintain fitness without the impact stress of more running. On cross-training days, don't go so hard that you compromise the next day's run. These are supporting work, not primary training.</p>
    </div>

    <div class="info-card">
      <h3>Nutrition During Training</h3>

      <h4>Day to Day</h4>
      <p><strong>You don't need a special diet.</strong> Eat real food, enough of it, and prioritize protein. At 180 lbs with this training load, aim for roughly 120â€“140g of protein per day to support muscle repair. Carbs are your friend during a training block â€” don't avoid them.</p>

      <h4>Before Runs</h4>
      <p><strong>Short/easy runs:</strong> You can run on an empty stomach if that works for you. Some people do fine fasted in the morning for runs under 5 miles.</p>
      <p><strong>Long runs and tempos:</strong> Eat 60â€“90 min before. Something with carbs, low fiber, low fat. A banana, toast with peanut butter, oatmeal â€” whatever you know doesn't cause GI issues.</p>

      <h4>During Runs</h4>
      <p><strong>Under 8 miles:</strong> Water is fine. You don't need fuel.</p>
      <p><strong>8+ miles:</strong> Bring water. Consider a gel or chews around mile 5â€“6. Practice this during training â€” never try a new fuel strategy on race day.</p>

      <h4>Hydration</h4>
      <p>General rule: drink when thirsty, don't force it. On long run days, make sure you're well-hydrated in the 12 hours leading up to the run. If your pee is light yellow, you're good. If it's clear, you might be overdoing it (yes, that's a thing).</p>

      <h4>Race Week</h4>
      <p>No dramatic changes. Eat what you normally eat. The night before the race, a carb-heavy dinner is fine but don't stuff yourself. Race morning: eat your usual pre-long-run meal 2â€“3 hours before the start. Stick with what you've practiced.</p>
    </div>

    <div class="info-card">
      <h3>Race Day Tips</h3>
      <p><strong>Start conservative.</strong> Your first 3 miles should feel easy â€” slightly slower than goal pace. The adrenaline will make goal pace feel too easy at the start. Don't fall for it.</p>
      <p><strong>Miles 4â€“10</strong> are where you settle in. Find your rhythm, lock into ~9:55/mi. Don't chase people.</p>
      <p><strong>Miles 10â€“13.1</strong> are where the training pays off. If you've got anything left, pick it up here. If not, just hold on â€” you've done the work.</p>
      <p><strong>Nothing new on race day.</strong> Same shoes, same socks, same fuel, same pre-run meal. Race day is not for experimentation.</p>
    </div>

  </div>
</div>

<div class="modal-overlay" id="modal">
  <div class="modal-sheet" id="modalSheet">
    <div class="modal-handle"></div>
    <div id="modalContent"></div>
  </div>
</div>

<script>
// â”€â”€â”€ TRAINING PLAN DATA â”€â”€â”€
const PLAN = {};
const WEEK_MAP = { Mon:0, Tue:1, Wed:2, Thu:3, Fri:4, Sat:5, Sun:6 };
const NOTES = {
  Easy: "Keep it conversational. ~11:00-12:00/mi pace. No pressure.",
  Long: "Start easy, negative split the last 1-2 mi if you're feeling it. Hydrate for 8+ mi.",
  Tempo: "Warm up 0.5 mi easy. Middle miles at ~9:30-9:45/mi. Cool down 0.5 mi easy.",
  "Cross-train": "Your choice â€” weighted walk, climbing, yoga, whatever feels right.",
  Rest: "Full rest. Recovery is where the gains happen.",
  Shakeout: "Short and easy. Shake out the legs, stay loose for tomorrow.",
  "RACE DAY": "This is it. Trust the training. Go get that sub-2:10."
};

const weeks = [
  ["2026-02-02", {Tue:["Easy","3.5mi"],Wed:["Cross-train",""],Thu:["Easy","3.5mi"],Sat:["Easy","3mi"],Sun:["Long","5mi"]}],
  ["2026-02-09", {Tue:["Easy","3.5mi"],Wed:["Cross-train",""],Thu:["Tempo","4mi"],Sat:["Easy","3mi"],Sun:["Long","6mi"]}],
  ["2026-02-16", {Tue:["Easy","4mi"],Wed:["Cross-train",""],Thu:["Tempo","4mi"],Sat:["Easy","3mi"],Sun:["Long","7mi"]}],
  ["2026-02-23", {Tue:["Easy","3.5mi"],Wed:["Cross-train",""],Thu:["Easy","3.5mi"],Sat:["Easy","3mi"],Sun:["Long","5mi"]}],
  ["2026-03-02", {Tue:["Easy","4mi"],Wed:["Cross-train",""],Thu:["Tempo","4.5mi"],Sat:["Easy","3.5mi"],Sun:["Long","8mi"]}],
  ["2026-03-09", {Tue:["Easy","4mi"],Wed:["Cross-train",""],Thu:["Tempo","5mi"],Sat:["Easy","3.5mi"],Sun:["Long","9mi"]}],
  ["2026-03-16", {Tue:["Easy","4.5mi"],Wed:["Cross-train",""],Thu:["Tempo","5mi"],Sat:["Easy","3.5mi"],Sun:["Long","10mi"]}],
  ["2026-03-23", {Tue:["Easy","3.5mi"],Wed:["Cross-train",""],Thu:["Easy","4mi"],Sat:["Easy","3mi"],Sun:["Long","7mi"]}],
  ["2026-03-30", {Tue:["Easy","4.5mi"],Wed:["Cross-train",""],Thu:["Tempo","5mi"],Sat:["Easy","4mi"],Sun:["Long","11mi"]}],
  ["2026-04-06", {Tue:["Easy","4.5mi"],Wed:["Cross-train",""],Thu:["Tempo","5mi"],Sat:["Easy","4mi"],Sun:["Long","12mi"]}],
  ["2026-04-13", {Tue:["Easy","4mi"],Wed:["Cross-train",""],Thu:["Tempo","4mi"],Sat:["Easy","3mi"],Sun:["Long","8mi"]}],
  ["2026-04-20", {Tue:["Easy","3mi"],Wed:["Cross-train",""],Thu:["Easy","2mi"],Sat:["Shakeout","2mi"],Sun:["RACE DAY","13.1mi"]}],
];

weeks.forEach(([startStr, workouts]) => {
  const start = new Date(startStr + "T00:00:00");
  for (const [dayName, [type, dist]] of Object.entries(workouts)) {
    const d = new Date(start);
    d.setDate(d.getDate() + WEEK_MAP[dayName]);
    PLAN[dateKey(d)] = { type, dist };
  }
  ["Mon","Fri"].forEach(dayName => {
    const d = new Date(start);
    d.setDate(d.getDate() + WEEK_MAP[dayName]);
    const k = dateKey(d);
    if (!PLAN[k]) PLAN[k] = { type: "Rest", dist: "" };
  });
});

// â”€â”€â”€ STORAGE â”€â”€â”€
function getLog(key) {
  try { const d = localStorage.getItem("hm_" + key); return d ? JSON.parse(d) : null; }
  catch { return null; }
}
function setLog(key, data) {
  localStorage.setItem("hm_" + key, JSON.stringify(data));
}
function deleteLog(key) {
  localStorage.removeItem("hm_" + key);
}

// â”€â”€â”€ HELPERS â”€â”€â”€
function dateKey(d) {
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, '0');
  const day = String(d.getDate()).padStart(2, '0');
  return `${y}-${m}-${day}`;
}

function todayKey() { return dateKey(new Date()); }

function tagClass(type) {
  if (!type) return '';
  const t = type.toLowerCase();
  if (t === 'cross-train') return 'tag-cross';
  if (t === 'tempo') return 'tag-tempo';
  if (t === 'rest') return 'tag-rest';
  if (t === 'race day') return 'tag-race';
  return 'tag-easy';
}

function cardClass(type) {
  if (!type) return '';
  const t = type.toLowerCase();
  if (t === 'cross-train') return 'type-cross';
  if (t === 'tempo') return 'type-tempo';
  if (t === 'rest') return 'type-rest';
  if (t === 'race day') return 'type-race';
  if (t === 'shakeout') return 'type-shakeout';
  return 'type-easy';
}

const MONTHS = [
  { year: 2026, month: 1, label: "Feb" },
  { year: 2026, month: 2, label: "Mar" },
  { year: 2026, month: 3, label: "Apr" },
];

let currentMonthIdx = 0;

// Set initial month based on today
const now = new Date();
if (now.getFullYear() === 2026 && now.getMonth() === 2) currentMonthIdx = 1;
else if (now.getFullYear() === 2026 && now.getMonth() === 3) currentMonthIdx = 2;

// â”€â”€â”€ COUNTDOWN â”€â”€â”€
function updateCountdown() {
  const race = new Date("2026-04-26T00:00:00");
  const today = new Date();
  today.setHours(0,0,0,0);
  const diff = Math.ceil((race - today) / (1000 * 60 * 60 * 24));
  const el = document.getElementById("countdown");
  if (diff > 0) el.textContent = diff + "d to race";
  else if (diff === 0) el.textContent = "RACE DAY";
  else el.textContent = "Post-race";
}

// â”€â”€â”€ RENDER MONTH NAV â”€â”€â”€
function renderNav() {
  const nav = document.getElementById("monthNav");
  nav.innerHTML = MONTHS.map((m, i) =>
    `<button class="${i === currentMonthIdx ? 'active' : ''}" onclick="switchMonth(${i})">${m.label}</button>`
  ).join('');
}

function switchMonth(idx) {
  currentMonthIdx = idx;
  renderNav();
  renderCalendar();
  renderWeekSummary();
}

// â”€â”€â”€ RENDER CALENDAR â”€â”€â”€
function renderCalendar() {
  const { year, month } = MONTHS[currentMonthIdx];
  const firstDay = new Date(year, month, 1).getDay(); // 0=Sun
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const tk = todayKey();

  let html = '<div class="day-labels"><span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span></div>';
  html += '<div class="calendar-grid">';

  // Empty cells before first day
  for (let i = 0; i < firstDay; i++) {
    html += '<div class="cal-day empty"></div>';
  }

  for (let d = 1; d <= daysInMonth; d++) {
    const dt = new Date(year, month, d);
    const key = dateKey(dt);
    const plan = PLAN[key];
    const log = getLog(key);
    const isToday = key === tk;
    const isRest = plan && plan.type === 'Rest';

    let classes = 'cal-day';
    if (isToday) classes += ' today';
    if (log) classes += ' has-log';
    if (isRest) classes += ' rest-day';

    html += `<div class="${classes}" onclick="openDay('${key}')">`;
    html += `<span class="date-num">${d}</span>`;
    if (plan) {
      html += `<span class="workout-tag ${tagClass(plan.type)}">${plan.type === 'Cross-train' ? 'Cross' : plan.type === 'RACE DAY' ? 'Race' : plan.type}</span>`;
      const displayDist = (log && log.distance) ? log.distance : plan.dist;
      if (displayDist) html += `<span class="workout-dist">${displayDist}</span>`;
    }
    html += '</div>';
  }

  html += '</div>';
  document.getElementById("calendarContainer").innerHTML = html;
}

// â”€â”€â”€ WEEK SUMMARY â”€â”€â”€
function renderWeekSummary() {
  const { year, month } = MONTHS[currentMonthIdx];
  const today = new Date();
  today.setHours(0,0,0,0);

  // Find the current week (Mon-Sun) if it overlaps this month
  const dayOfWeek = today.getDay(); // 0=Sun
  const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
  const monday = new Date(today);
  monday.setDate(today.getDate() + mondayOffset);
  const sunday = new Date(monday);
  sunday.setDate(monday.getDate() + 6);

  // Check if this week is in the displayed month
  const monthStart = new Date(year, month, 1);
  const monthEnd = new Date(year, month + 1, 0);

  if (sunday < monthStart || monday > monthEnd) {
    document.getElementById("weekSummary").style.display = "none";
    return;
  }

  let planned = 0;
  let logged = 0;

  for (let i = 0; i < 7; i++) {
    const d = new Date(monday);
    d.setDate(monday.getDate() + i);
    const key = dateKey(d);
    const plan = PLAN[key];
    if (plan && plan.dist) {
      planned += parseFloat(plan.dist) || 0;
    }
    const log = getLog(key);
    if (log && log.distance) {
      logged += parseFloat(log.distance) || 0;
    }
  }

  const weekNum = Math.ceil((today - new Date("2026-02-02T00:00:00")) / (7 * 24 * 60 * 60 * 1000)) + 1;
  const clampedWeek = Math.max(1, Math.min(12, weekNum));

  const el = document.getElementById("weekSummary");
  el.style.display = "flex";
  el.innerHTML = `
    <div class="week-summary-label">This week<br><strong>Week ${clampedWeek} of 12</strong></div>
    <div class="week-summary-stats">
      <div class="week-stat"><div class="val">${planned}</div><div class="label">Planned mi</div></div>
      <div class="week-stat"><div class="val">${logged || 'â€”'}</div><div class="label">Logged mi</div></div>
    </div>
  `;
}

// â”€â”€â”€ PLAN SUMMARY â”€â”€â”€
function renderPlanSummary() {
  document.getElementById("planSummary").innerHTML = `
    <div class="plan-summary">
      <h3>Plan Overview</h3>
      <div class="phase"><span class="desc">Base building</span><span class="weeks">Wk 1-3</span><span class="miles">15-18 mi/wk</span></div>
      <div class="phase"><span class="desc">Cutback</span><span class="weeks">Wk 4</span><span class="miles">~15 mi/wk</span></div>
      <div class="phase"><span class="desc">Build</span><span class="weeks">Wk 5-7</span><span class="miles">20-23 mi/wk</span></div>
      <div class="phase"><span class="desc">Cutback</span><span class="weeks">Wk 8</span><span class="miles">~17.5 mi/wk</span></div>
      <div class="phase"><span class="desc">Peak</span><span class="weeks">Wk 9-10</span><span class="miles">24.5-25.5 mi/wk</span></div>
      <div class="phase"><span class="desc">Taper</span><span class="weeks">Wk 11-12</span><span class="miles">19 â†’ 7 mi/wk</span></div>
    </div>
  `;
}

// â”€â”€â”€ DAY DETAIL MODAL â”€â”€â”€
function openDay(key) {
  const plan = PLAN[key];
  if (!plan) return;

  const [y, m, d] = key.split('-').map(Number);
  const dt = new Date(y, m - 1, d);
  const dayNames = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
  const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  const log = getLog(key) || {};

  const isRest = plan.type === 'Rest';

  let html = `
    <div class="modal-date">${monthNames[m-1]} ${d}</div>
    <div class="modal-weekday">${dayNames[dt.getDay()]}</div>
    <div class="modal-workout-card ${cardClass(plan.type)}">
      <div class="workout-card-type" style="color:${typeColor(plan.type)}">${plan.type}</div>
      ${plan.dist ? `<div class="workout-card-dist">${plan.dist}</div>` : ''}
      <div class="workout-card-note">${NOTES[plan.type] || ''}</div>
    </div>
  `;

  html += `<div class="log-section"><h4>Your Log</h4>`;

  html += `
    <div class="log-field">
      <label>Actual distance</label>
      <input type="text" id="logDist" inputmode="decimal" placeholder="e.g. 4.2 mi" value="${log.distance || ''}">
    </div>
    <div class="log-field">
      <label>Time</label>
      <input type="text" id="logTime" placeholder="e.g. 42:30" value="${log.time || ''}">
    </div>
  `;

  html += `
    <div class="log-field">
      <label>How'd it feel?</label>
      <select id="logFeel">
        <option value="">â€”</option>
        <option value="great" ${log.feel === 'great' ? 'selected' : ''}>Great</option>
        <option value="good" ${log.feel === 'good' ? 'selected' : ''}>Good</option>
        <option value="ok" ${log.feel === 'ok' ? 'selected' : ''}>OK</option>
        <option value="rough" ${log.feel === 'rough' ? 'selected' : ''}>Rough</option>
        <option value="skipped" ${log.feel === 'skipped' ? 'selected' : ''}>Skipped</option>
      </select>
    </div>
    <div class="log-field">
      <label>Notes</label>
      <textarea id="logNotes" placeholder="Anything worth remembering...">${log.notes || ''}</textarea>
    </div>
    <div class="log-actions">
      <button class="btn btn-primary" onclick="saveLog('${key}')">Save</button>
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
    </div>
    ${log.distance || log.feel || log.notes ? `<div class="log-actions"><button class="btn btn-danger" onclick="clearLog('${key}')">Clear log</button></div>` : ''}
    <div class="saved-indicator" id="savedMsg">Saved</div>
  </div>`;

  document.getElementById("modalContent").innerHTML = html;

  const overlay = document.getElementById("modal");
  overlay.classList.add("open");
  document.body.style.overflow = "hidden";
}

function typeColor(type) {
  const t = type.toLowerCase();
  if (t === 'cross-train') return 'var(--blue)';
  if (t === 'tempo') return 'var(--orange)';
  if (t === 'rest') return 'var(--rest-color)';
  if (t === 'race day') return 'var(--red)';
  return 'var(--green)';
}

function closeModal() {
  document.getElementById("modal").classList.remove("open");
  document.body.style.overflow = "";
}

function saveLog(key) {
  const data = {};

  data.distance = document.getElementById("logDist").value.trim();
  data.time = document.getElementById("logTime").value.trim();
  data.feel = document.getElementById("logFeel").value;
  data.notes = document.getElementById("logNotes").value.trim();

  if (data.distance || data.time || data.feel || data.notes) {
    setLog(key, data);
  } else {
    deleteLog(key);
  }

  const msg = document.getElementById("savedMsg");
  msg.classList.add("show");
  setTimeout(() => {
    msg.classList.remove("show");
    closeModal();
    renderCalendar();
    renderWeekSummary();
  }, 600);
}

function clearLog(key) {
  deleteLog(key);
  closeModal();
  renderCalendar();
  renderWeekSummary();
}

// Close modal on overlay click
document.getElementById("modal").addEventListener("click", (e) => {
  if (e.target === e.currentTarget) closeModal();
});

// â”€â”€â”€ INFO PANEL â”€â”€â”€
function openInfo() {
  document.getElementById("infoPanel").classList.add("open");
  document.body.style.overflow = "hidden";
}

function closeInfo() {
  document.getElementById("infoPanel").classList.remove("open");
  document.body.style.overflow = "";
}

// â”€â”€â”€ BACKUP: EXPORT / IMPORT â”€â”€â”€
function showToast(msg) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 2000);
}

function exportData() {
  const data = {};
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith("hm_")) {
      try { data[key] = JSON.parse(localStorage.getItem(key)); }
      catch { data[key] = localStorage.getItem(key); }
    }
  }
  const count = Object.keys(data).length;
  if (count === 0) { showToast("Nothing to export yet"); return; }

  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "hm_training_backup_" + todayKey() + ".json";
  a.click();
  URL.revokeObjectURL(url);
  showToast("Exported " + count + " log entries");
}

function importData(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      let count = 0;
      for (const [key, val] of Object.entries(data)) {
        if (key.startsWith("hm_")) {
          localStorage.setItem(key, typeof val === 'string' ? val : JSON.stringify(val));
          count++;
        }
      }
      renderCalendar();
      renderWeekSummary();
      showToast("Imported " + count + " log entries");
    } catch {
      showToast("Invalid backup file");
    }
  };
  reader.readAsText(file);
  event.target.value = "";
}

// â”€â”€â”€ INIT â”€â”€â”€
updateCountdown();
renderNav();
renderCalendar();
renderWeekSummary();
renderPlanSummary();
</script>
</body>
</html>
